---
title: Logistic Regression
author: Adogbeji Agberien
date: '2021-04-23'
slug: []
categories: []
tags: []
subtitle: ''
summary: 'This post is about Logistic Regression; currently just implementation in R, hopefully will soon update to include the theory of the method'
authors: []
lastmod: '2021-04-23T17:54:50-04:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---

This post is about logistic regression; the theory and its implementation in R. Data from [superdatascience](https://www.superdatascience.com/pages/machine-learning). 

```{r warning=F, message = F}
# Install and load packages
required_packages <- c("tidyverse", "data.table", "caTools",
                       "rmarkdown", "knitr")

packageCheck <- lapply(required_packages, FUN = function(x) {
  if(!require(x, character.only = TRUE)) {
    install.packages(x, dependencies = TRUE)
    library(x, character.only = TRUE)
  }
})
```

```{r}
# Import the data 
social_network_ads <- fread("C:/Users/diji_/Desktop/Data Science/Machine Learning A-Z (Codes and Datasets)/Part 3 - Classification/Section 14 - Logistic Regression/R/Social_Network_Ads.csv")
```

Can we make predictions on whether or not an individual will purchase an item given Gender, Age, and Salary?

```{r}
# Show the first few rows of the data
head(social_network_ads)
```

From the above, we see that we are given User ID, Gender, Age, Estimated Salary, and whether or not the individual made a purchase. The User ID intuitively wouldn't have an effect of whether or not an individual purchases an item, so we do not need to include it in the model we make. Gender...well who knows it will have an effect...our model will inform us, but we have to encode the categorical variable before including it. We likely have to scale because variables Age will likely be "overshadowed" by Salary given their different ranges and variances. 

```{r}
# Encode Gender 
the_genders <- unique(social_network_ads$Gender)
social_network_ads$Gender <- factor(social_network_ads$Gender, levels = the_genders, labels = c(1, 2))
```

```{r}
# Split the data into training and test sets 
set.seed(123)
data_split <- sample.split(social_network_ads$Purchased, SplitRatio = 0.8)
training_set <- subset(social_network_ads, data_split == T)
test_set <- subset(social_network_ads, data_split == F)
```

```{r}
social_glm <- glm(Purchased ~ EstimatedSalary + Age + Gender, data = training_set, family = binomial(link = "logit"))
summary(social_glm)
```

From the above we see that gender is deemed as insignificant with p-value of 0.328, so we exclude it from the model. 

```{r}
social_glm_no_gender <- glm(Purchased ~ EstimatedSalary + Age, data = training_set, family = binomial(link = "logit"))
summary(social_glm_no_gender)
```

```{r}
# Make predictions on the test set
purchase_probability_test <- predict(social_glm_no_gender, type = "response", test_set)
purchase_prediction_test <- if_else(purchase_probability_test > 0.5, 1, 0)
```

```{r}
# Make a confusion matrix to evaluate prediction accuracy
confusion_matrix = table(purchase_prediction_test, test_set$Purchased)
confusion_matrix
```
From the confusion matrix above, we see that 44 individuals were correctly classified for not making purchases, and 21 were correctly classified for making purchases. 7 individuals were wrongly classified as having made a purchase when indeed they did not, and 8 individuals were also wrongly classified as not making purchased when indeed they made purchases. Thanks logistic regression. 

Below we create a grid for aesthetically pleasing visualization of the purchase prediction. 
```{r}
# Create a grid for visualization
the_grid <- expand.grid(seq(min(test_set$EstimatedSalary), max(test_set$EstimatedSalary), 100),
                        seq(min(test_set$Age), max(test_set$Age), 0.1)) %>% data.table() %>% 
  setnames(old = c("Var1", "Var2"), new = c("EstimatedSalary", "Age"))
```

```{r}
# Make a prediction on the grid data 
grid_prediction_prob <- predict(social_glm_no_gender, type = "response", the_grid)
grid_prediction <- if_else(grid_prediction_prob > 0.5, 1, 0)
```

```{r}
ggplot() +
  geom_point(aes(the_grid$EstimatedSalary, the_grid$Age, colour = as.factor(grid_prediction), alpha = 0.3)) +
  geom_point(aes(test_set$EstimatedSalary, test_set$Age, colour = as.factor(test_set$Purchased))) +
  xlab("Salary") +
  ylab("Age") +
  ggtitle("Logistic Regression used to predict purchase of an item based on age and salary.") +
  theme_classic()
```
